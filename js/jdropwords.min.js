jQuery.fn.jDropWords=function(e){function r(e,t){e.draggable("disable");var n=s(e);n.prependTo(t);t.addClass("active");e.hide()}function s(e){var t='<div class="'+n.droppedClass+' clearfix" rel="'+e.attr("id")+'">'+"<span>"+e.html()+"</span>"+'<div class="action"><a href="#" class="close">x</a></div>'+"</div>";var r=$(t);$("a",r).click(function(){r.parent().removeClass("active");u(e);r.remove()});return r}function o(e,t){if(n.beforeDrop&&jQuery.isFunction(n.beforeDrop)){n.beforeDrop(e,t)}r($(".ui-draggable-dragging"),$(this));if(n.onDrop&&jQuery.isFunction(n.onDrop)){n.afterDrop(e,t)}}function u(e){e.show();e.draggable("enable")}function a(e){$(".word",e).each(function(){$(this).draggable("disable");u($(this))});$(".blank",e).html("");$(".blank",e).removeClass("active");$(".blanks p .blank",e).removeClass("error").removeClass("success");$(".feedback",e).remove();$(".overlay",e).remove();$(".submit",e).removeAttr("disabled")}function f(e){$(".word",e).draggable({containment:e,revert:true});var t=0;$(".word",e).each(function(){var e=$(this).width();if(e>t){t=e}});$(".blank",e).each(function(){l($(this));$(this).width(t)});$(".submit",e).click(function(){if($(this).attr("disabled")=="disabled"){return false}c(e)});$(".reset",e).click(function(){if($(this).attr("disabled")=="disabled"){return false}a(e)})}function l(e){e.droppable({drop:o,hoverClass:n.hoverClass})}function c(e){var t=n.answers;if(typeof t=="string"||t instanceof String){$.get(t,function(t){h(t,e)},"json")}else{h(t,e)}$(".submit",e).attr("disabled","disabled")}function h(e,t){var r=0;var i=0;var s=75;var o=100;var u=s+o;var a=0;$(".blanks p .blank",t).each(function(){var t=$(this).attr("id");var s=$("."+n.droppedClass,$(this));var o=e[t];var f=s.attr("rel");var l=n.errorClass;if(f==o){l=n.successClass;r++}var c=$(this);if(s.length){var h=parseInt(s.css("top"));s.delay(a).animate({top:h-7+"px"},{duration:75,queue:true,complete:function(){c.addClass(l)}}).animate({top:h+"px"},{duration:100,queue:true});a+=u}else{$(this).addClass(l)}i++});setTimeout(function(){p(t,r,i)},a+u);d(t);if(n.afterCorrection&&jQuery.isFunction(n.afterCorrection)){n.afterCorrection(r,i)}if(n.submitAjax){var f={score:r,nbqst:i};f=$.extend({},f,n.submitAjaxExtraParams);$.post(n.submitAjaxUrl,f)}}function p(e,t,r){var s=v();var o=$(s);e.prepend(o);o.show();var u=Math.round(t/r*100);var a=null;for(i in n.feedbacks){if(u<=i){a=n.feedbacks[i];break}}m(35,35,t+"/"+r,function(){$(".feedback p").text(a)})}function d(e){$(".words",e).prepend('<div class="overlay"></div>');$(".blanks",e).prepend('<div class="overlay"></div>')}function v(){var e='<div class="feedback clearfix" style="display: none;">'+"<p></p>"+'<div class="score">'+'<canvas id="score-canvas" width="70" height="70"></canvas>'+"</div>"+"</div>";return e}function m(e,t,n,r){function v(e,t,n,r){e.lineWidth=1;e.fillStyle="#000000";e.lineStyle="#286090";e.font="24px Arial";e.fillText(r,t-17,n+7)}function m(c){o.lineWidth=10;o.clearRect(0,0,s.width,s.height);o.beginPath();o.arc(e,t,a,-p,h*c-p,false);o.stroke();l+=d;if(u.length){for(var g=0;g<u.length;g++){o.lineWidth=10;o.beginPath();o.arc(u[g].x,u[g].y,a,-p,h*u[g].curr-p,false);o.stroke();v(o,u[g].x,u[g].y,u[g].text)}}if(l<f){i(function(){m(l/100)})}else{var b={x:e,y:t,curr:c,text:n};u.push(b);v(o,e,t,n);if(r)r.call()}}var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=i;var s=document.getElementById("score-canvas");var o=s.getContext("2d");var u=[];var a=30;var f=101;var l=0;var c=false;var h=Math.PI*2;var p=Math.PI/2;var d=4;o.lineWidth=10;o.strokeStyle="#286090";o.shadowOffsetX=0;o.shadowOffsetY=0;m()}var t={hoverClass:"drop-hover",droppedClass:"dropped",errorClass:"error",successClass:"success",beforeDrop:null,afterDrop:null,afterCorrection:null,submitAjax:false,submitAjaxUrl:"",submitAjaxExtraParams:{},feedbacks:{50:"Low score, please try again.",80:"Not perfect, but good.",100:"Bravo ! You nailed it."},answers:null};var n=$.extend({},t,e);return this.each(function(){var e=$(this);f(e)})}